{% extends "base.html" %}

{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-end mb-4 gap-3">
    <div class="col-12 col-md-8">
        <h5 class="text-light fw-bold mb-1 text-uppercase small" style="letter-spacing: 1px; opacity: 0.7;">Overview</h5>
        <h2 class="fw-bold text-white display-6 text-capitalize">Hello, {{ current_user.username.split('@')[0] }}</h2>
    </div>
    <div class="col-12 col-md-3 text-md-end">
        <a href="{{ url_for('file_complaint') }}" class="btn btn-primary w-100 w-md-auto px-4 py-2 fw-bold" 
           style="background-color: #2563eb; border: none; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);">
           + New Ticket
        </a>
    </div>
</div>

<div class="row mb-5 g-3">
    <div class="col-12 col-md-4">
        <div class="card-pro p-4 h-100">
            <h6 class="text-white text-uppercase small fw-bold" style="opacity: 0.7;">Total Tickets</h6>
            <h2 class="text-white fw-bold display-6 mb-0 mt-2">{{ total }}</h2>
        </div>
    </div>
    <div class="col-12 col-md-4">
        <div class="card-pro p-4 h-100">
            <h6 class="text-white text-uppercase small fw-bold" style="opacity: 0.7;">Pending</h6>
            <h2 class="fw-bold display-6 mb-0 mt-2" style="color: #f59e0b;">{{ pending }}</h2>
        </div>
    </div>
    <div class="col-12 col-md-4">
        <div class="card-pro p-4 h-100">
            <h6 class="text-white text-uppercase small fw-bold" style="opacity: 0.7;">Resolved</h6>
            <h2 class="fw-bold display-6 mb-0 mt-2" style="color: #10b981;">{{ resolved }}</h2>
        </div>
    </div>
</div>

<div class="card-pro overflow-hidden">
    <div class="p-4 border-bottom border-secondary" style="border-color: #334155 !important;">
        <h5 class="text-white fw-bold mb-0">Recent Tickets</h5>
    </div>
    
    <div class="table-responsive">
        <table class="table table-dark table-hover mb-0 align-middle text-nowrap">
            <thead style="background-color: #0f172a;">
                <tr>
                    <th class="ps-4 py-3 text-white small" style="opacity: 0.6;">ID</th>
                    <th class="py-3 text-white small" style="opacity: 0.6;">SUBJECT</th>
                    <th class="py-3 text-white small" style="opacity: 0.6;">PRIORITY</th>
                    <th class="py-3 text-white small" style="opacity: 0.6;">CATEGORY</th>
                    <th class="py-3 text-end pe-4 text-white small" style="opacity: 0.6;">ACTION</th>
                </tr>
            </thead>
            <tbody>
                {% for complaint in complaints %}
                <tr style="border-bottom: 1px solid #334155;">
                    <td class="ps-4 text-white fw-bold">#{{ complaint.id }}</td>
                    <td class="text-white fw-bold">{{ complaint.subject }}</td>
                    
                    <td>
                        {% if complaint.priority == 'High' %}
                            <span class="badge bg-danger rounded-1 px-3">High</span>
                        {% elif complaint.priority == 'Medium' %}
                            <span class="badge bg-warning text-dark rounded-1 px-3">Medium</span>
                        {% else %}
                            <span class="badge bg-secondary rounded-1 px-3">Low</span>
                        {% endif %}
                    </td>

                    <td><span class="badge bg-transparent border border-secondary text-light rounded-1" style="opacity: 0.9;">{{ complaint.category }}</span></td>
                    
                    <td class="text-end pe-4">
                        <a href="{{ url_for('ticket_detail', id=complaint.id) }}" 
                           class="btn btn-sm btn-outline-primary fw-bold px-4 rounded-1" 
                           style="border-color: #334155; color: white;">
                           {% if complaint.status == 'Resolved' %}
                                View Resolved
                           {% else %}
                                View / Reply
                           {% endif %}
                        </a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="text-center py-5">
                        <p class="text-light mb-0" style="opacity: 0.5;">No tickets found.</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}